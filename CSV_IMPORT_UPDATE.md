# 🎉 تحديث نظام استيراد CSV - دعم المناطق الفرعية والفئات الفرعية

## ✨ الميزات الجديدة

تم تحديث نظام استيراد الشركات من ملفات CSV ليدعم:

### 1️⃣ الفئات الفرعية (SubCategories)
- إمكانية تحديد فئة فرعية أكثر دقة للشركات
- **مثال**: 
  - الفئة الرئيسية: `التكنولوجيا`
  - الفئة الفرعية: `تطوير البرمجيات`، `تصميم المواقع`، `الأمن السيبراني`

### 2️⃣ المناطق الفرعية (Sub Areas)
- إمكانية تحديد منطقة أو حي محدد ضمن المدينة
- **مثال**: 
  - المدينة: `دمشق`
  - المنطقة الفرعية: `المزة`، `أبو رمانة`، `المالكي`

## 📋 الملفات المحدثة

### خدمات المعالجة:
1. **`lib/services/company-import-service.ts`**
   - ✅ إضافة معالجة الفئة الفرعية
   - ✅ إضافة معالجة المنطقة الفرعية
   - ✅ تحديث cleanRowData لدعم الحقول الجديدة
   - ✅ تحديث createCompany لحفظ البيانات الجديدة

2. **`lib/services/location-mapping-service-simple.ts`**
   - ✅ إضافة دالة `mapSubArea()`
   - ✅ إضافة دالة `loadExistingSubAreas()`
   - ✅ إضافة دوال مساعدة للبحث والاستعلام

3. **`lib/services/category-mapping-service-simple.ts`**
   - ✅ إضافة دالة `mapSubCategory()`
   - ✅ إضافة دالة `loadExistingSubCategories()`
   - ✅ إضافة دوال مساعدة للبحث والاستعلام

### التوثيق:
1. **`docs/CSV_IMPORT_SYSTEM.md`**
   - ✅ تحديث هيكل CSV المدعوم
   - ✅ إضافة شرح للحقول الجديدة
   - ✅ إضافة أمثلة محدثة

2. **`docs/CSV_SUBCATEGORIES_SUBAREAS_GUIDE.md`** (جديد)
   - ✅ دليل شامل لاستخدام الميزات الجديدة
   - ✅ أمثلة عملية متعددة
   - ✅ استكشاف الأخطاء والحلول

### ملفات الأمثلة:
1. **`example-import-with-subcategories.csv`** (جديد)
   - ✅ ملف CSV نموذجي يوضح استخدام جميع الحقول
   - ✅ 7 شركات مثالية بسيناريوهات مختلفة

## 🚀 كيفية الاستخدام

### 1. تحضير ملف CSV

أضف الأعمدة الجديدة إلى ملف CSV الخاص بك:

```csv
Nom,Catégorie,SubCategory,Country,City,SubArea,Adresse,Téléphone
"شركة التقنية","التكنولوجيا","تطوير البرمجيات","سوريا","دمشق","المزة","شارع المزة","+963 11 1234567"
```

### 2. تسميات الأعمدة المدعومة

النظام يدعم تسميات متعددة للمرونة:

**للفئة الفرعية:**
- `SubCategory`
- `subCategory`
- `Sub Category`

**للمنطقة الفرعية:**
- `SubArea`
- `subArea`
- `Sub Area`

### 3. استيراد الملف

1. انتقل إلى `/admin/companies/import`
2. ارفع ملف CSV
3. فعّل الإعدادات المطلوبة:
   - ✅ `إنشاء الفئات المفقودة` - لإنشاء فئات فرعية جديدة
   - ✅ `إنشاء المدن المفقودة` - لإنشاء مناطق فرعية جديدة
4. ابدأ الاستيراد

## 📝 ملاحظات مهمة

### ✅ الحقول الاختيارية
- الفئة الفرعية والمنطقة الفرعية **اختيارية تماماً**
- لن تفشل العملية إذا كانت فارغة أو غير موجودة
- سيتم تسجيل تحذير فقط في حال عدم العثور عليها

### ✅ الإنشاء التلقائي
- إذا كانت الإعدادات تسمح، سيتم إنشاء العناصر الجديدة تلقائياً
- الفئات الفرعية تُربط بالفئة الرئيسية
- المناطق الفرعية تُربط بالمدينة والبلد

### ✅ آلية المطابقة
يتم المطابقة بثلاث مراحل:
1. **مطابقة دقيقة**: تطابق تام للنص
2. **تجاهل الأحرف**: مطابقة بتجاهل حالة الأحرف
3. **مطابقة جزئية**: إذا كان النص يحتوي على الكلمة المطلوبة

## 📊 أمثلة عملية

### مثال 1: شركة بجميع التفاصيل
```csv
Nom,Catégorie,SubCategory,Country,City,SubArea,Téléphone
"شركة ABC","التكنولوجيا","تطوير البرمجيات","سوريا","دمشق","المزة","+963 11 1234567"
```
✅ سيتم ربط الشركة بالفئة والفئة الفرعية والمدينة والمنطقة الفرعية

### مثال 2: شركة بدون فئة فرعية
```csv
Nom,Catégorie,SubCategory,Country,City,SubArea,Téléphone
"مطعم الشام","الأغذية والمطاعم","","سوريا","حلب","الشهباء","+963 21 2345678"
```
✅ سيتم ربط الشركة بالفئة الرئيسية والمنطقة الفرعية فقط

### مثال 3: شركة بدون منطقة فرعية
```csv
Nom,Catégorie,SubCategory,Country,City,SubArea,Téléphone
"عيادة النور","الرعاية الصحية","طب الأسنان","سوريا","دمشق","","+963 11 3456789"
```
✅ سيتم ربط الشركة بالفئة والفئة الفرعية فقط

### مثال 4: شركة بدون كليهما
```csv
Nom,Catégorie,Country,City,Téléphone
"محل البركة","التجارة","سوريا","حمص","+963 31 4567890"
```
✅ سيتم ربط الشركة بالفئة الرئيسية والمدينة فقط

## 🔍 استكشاف الأخطاء

### رسالة: "تحذير: لم يتم العثور على الفئة الفرعية"

**السبب:**
- الفئة الفرعية غير موجودة في قاعدة البيانات
- إعداد `createMissingCategories` معطل

**الحل:**
1. فعّل إعداد `إنشاء الفئات المفقودة`
2. أو أضف الفئة الفرعية يدوياً من لوحة التحكم
3. أو اترك الحقل فارغاً

**النتيجة:**
- ✅ العملية ستستمر بنجاح
- ⚠️ سيتم إنشاء الشركة بدون الفئة الفرعية

### رسالة: "تحذير: لم يتم العثور على المنطقة الفرعية"

**السبب:**
- المنطقة الفرعية غير موجودة في قاعدة البيانات
- إعداد `createMissingCities` معطل

**الحل:**
1. فعّل إعداد `إنشاء المدن المفقودة`
2. أو أضف المنطقة الفرعية يدوياً من لوحة التحكم
3. أو اترك الحقل فارغاً

**النتيجة:**
- ✅ العملية ستستمر بنجاح
- ⚠️ سيتم إنشاء الشركة بدون المنطقة الفرعية

## 📚 الموارد والتوثيق

### الأدلة:
- 📖 [دليل استيراد CSV الكامل](./docs/CSV_IMPORT_SYSTEM.md)
- 📖 [دليل المناطق والفئات الفرعية](./docs/CSV_SUBCATEGORIES_SUBAREAS_GUIDE.md)
- 📖 [دليل مطابقة المواقع](./CSV_LOCATION_MATCHING_GUIDE.md)

### الأمثلة:
- 📄 [ملف CSV نموذجي](./example-import-with-subcategories.csv)

## 🎯 الخطوات التالية

بعد الاستيراد، يمكنك:
1. ✅ مراجعة الشركات المستوردة من لوحة التحكم
2. ✅ تعديل الفئات الفرعية والمناطق الفرعية حسب الحاجة
3. ✅ دمج التصنيفات المكررة
4. ✅ إضافة تفاصيل إضافية للشركات

## 📞 الدعم

في حال واجهت أي مشاكل:
1. راجع [دليل استكشاف الأخطاء](./docs/CSV_SUBCATEGORIES_SUBAREAS_GUIDE.md#-استكشاف-الأخطاء)
2. تحقق من سجلات وحدة التحكم
3. راجع رسائل التحذير والأخطاء في تقرير الاستيراد

---

## 📊 الإحصائيات

**تاريخ التحديث:** أكتوبر 2025  
**الإصدار:** 2.0  
**الميزات الجديدة:** 2  
**الملفات المحدثة:** 3  
**وثائق جديدة:** 2  

---

*نظام مربعات - دليل الشركات الذكي* 🚀


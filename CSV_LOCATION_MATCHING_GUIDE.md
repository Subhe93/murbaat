# دليل مطابقة المواقع في استيراد CSV

## نظرة عامة
تم تحسين نظام استيراد الشركات لدعم أعمدة منفصلة للدولة والمدينة، مما يوفر مطابقة أكثر دقة للمواقع.

## تنسيق ملف CSV الجديد

### الأعمدة المطلوبة:
- `Nom` - اسم الشركة
- `Téléphone` - رقم الهاتف
- `Catégorie` - الفئة (يجب أن تطابق الفئات الموجودة في قاعدة البيانات)
- `Country` - الدولة (يجب أن تطابق الدول الموجودة في قاعدة البيانات)
- `City` - المدينة (يجب أن تطابق المدن الموجودة في قاعدة البيانات)
- `Adresse` - العنوان (اختياري)
- `SiteWeb` - الموقع الإلكتروني
- `Reviews` - المراجعات (JSON)

### مثال على ملف CSV:
```csv
Nom,Téléphone,Catégorie,Country,City,Adresse,SiteWeb,Reviews
شركة التكنولوجيا المتقدمة,+963 933 365 544,التكنولوجيا,سوريا,دمشق,دمشق - سوريا,https://example1.com,"[{""author"":""أحمد محمد"",""text"":""خدمة ممتازة"",""rating"":5}]"
مطعم الشام الأصيل,079 123 4567,الأغذية والمطاعم,الأردن,عمان,عمان - الأردن,https://example2.com,"[{""author"":""فاطمة علي"",""text"":""طعام لذيذ"",""rating"":4}]"
```

## نظام المطابقة

### 1. مطابقة الفئات
- **مطابقة دقيقة**: الاسم مطابق تماماً
- **مطابقة مع تجاهل الأحرف**: تجاهل حالة الأحرف (كبيرة/صغيرة)
- **مطابقة جزئية**: البحث في الأسماء التي تحتوي على النص
- **إنشاء فئة جديدة**: إذا لم يتم العثور على مطابقة

### 2. مطابقة الدول
- **مطابقة دقيقة**: اسم الدولة مطابق تماماً
- **مطابقة مع تجاهل الأحرف**: تجاهل حالة الأحرف
- **مطابقة جزئية**: البحث في أسماء الدول
- **إنشاء دولة جديدة**: مع كود دولة تلقائي

### 3. مطابقة المدن
- **مطابقة دقيقة**: اسم المدينة مطابق تماماً في نفس الدولة
- **مطابقة مع تجاهل الأحرف**: تجاهل حالة الأحرف
- **مطابقة جزئية**: البحث في أسماء المدن
- **إنشاء مدينة جديدة**: مرتبطة بالدولة المحددة

## الميزات الجديدة

### 1. واجهة عرض الفئات المتاحة
- عرض جميع الفئات الموجودة في قاعدة البيانات
- إمكانية البحث والتصفية
- نسخ أسماء الفئات بسهولة
- إحصائيات الفئات

### 2. واجهة عرض المواقع المتاحة
- عرض جميع الدول والمدن الموجودة
- تبويبات منفصلة للدول والمدن
- إمكانية البحث والتصفية
- نسخ أسماء الدول والمدن
- عرض المدن حسب الدولة المحددة

### 3. API Endpoints جديدة
- `/api/admin/categories/available` - جلب الفئات المتاحة
- `/api/admin/locations/countries` - جلب الدول المتاحة
- `/api/admin/locations/cities` - جلب المدن المتاحة

## نصائح للاستخدام

### 1. إعداد ملف CSV
- استخدم أسماء الفئات والدول والمدن تماماً كما هي في قاعدة البيانات
- يمكن تجاهل حالة الأحرف (كبيرة/صغيرة)
- في حالة عدم المطابقة، ستُنشأ فئات/دول/مدن جديدة

### 2. التحقق من البيانات
- استخدم واجهة "الفئات المتاحة" لمعرفة الأسماء الصحيحة
- استخدم واجهة "المواقع المتاحة" لمعرفة أسماء الدول والمدن
- انسخ الأسماء مباشرة من الواجهة لتجنب الأخطاء الإملائية

### 3. معالجة الأخطاء
- في حالة عدم العثور على مطابقة، سيتم إنشاء عنصر جديد
- تحقق من سجلات النظام لمعرفة التفاصيل
- يمكن تعديل البيانات المطابقة يدوياً بعد الاستيراد

## التوافق مع النسخة القديمة
- النظام يدعم الملفات القديمة التي تستخدم عمود `Adresse` فقط
- في حالة عدم وجود أعمدة `Country` و `City`، سيستخدم النظام العنوان القديم
- يمكن استخدام النظام الجديد والقديم في نفس الوقت

## مثال كامل

### ملف CSV:
```csv
Nom,Téléphone,Catégorie,Country,City,Adresse,SiteWeb,Reviews
شركة البرمجة الذكية,+963 11 123 4567,التكنولوجيا,سوريا,دمشق,شارع الجامعة - دمشق,https://smartcode.sy,"[{""author"":""أحمد علي"",""text"":""خدمة ممتازة"",""rating"":5}]"
مطعم الشام الأصيل,+962 6 123 4567,الأغذية والمطاعم,الأردن,عمان,شارع الملكة نور - عمان,https://shamrestaurant.jo,"[{""author"":""فاطمة محمد"",""text"":""طعام لذيذ"",""rating"":4}]"
مستشفى الرعاية الطبية,+966 11 123 4567,الرعاية الصحية,السعودية,الرياض,شارع الملك فهد - الرياض,https://carehospital.sa,"[{""author"":""محمد سالم"",""text"":""فريق طبي محترف"",""rating"":5}]"
```

### النتيجة المتوقعة:
- ✅ مطابقة فئة "التكنولوجيا" مع الفئة الموجودة
- ✅ مطابقة دولة "سوريا" مع الدولة الموجودة
- ✅ مطابقة مدينة "دمشق" مع المدينة الموجودة
- ✅ إنشاء شركة جديدة مع المطابقات الصحيحة

## استكشاف الأخطاء

### مشاكل شائعة:
1. **فئة غير موجودة**: تحقق من اسم الفئة في واجهة "الفئات المتاحة"
2. **دولة غير موجودة**: تحقق من اسم الدولة في واجهة "المواقع المتاحة"
3. **مدينة غير موجودة**: تحقق من اسم المدينة وارتباطها بالدولة الصحيحة
4. **أخطاء إملائية**: استخدم النسخ من الواجهة لتجنب الأخطاء

### حلول:
- استخدم البحث في الواجهات للعثور على الأسماء الصحيحة
- انسخ الأسماء مباشرة من الواجهة
- تحقق من سجلات النظام لمعرفة تفاصيل المطابقة
- يمكن تعديل البيانات بعد الاستيراد من لوحة الإدارة

# 📋 دليل استخدام المناطق الفرعية والفئات الفرعية في استيراد CSV

## 🎯 نظرة عامة

تم تحديث نظام استيراد الشركات من CSV ليدعم حقلين جديدين اختياريين:
- **المناطق الفرعية (Sub Areas)**: لتحديد منطقة محددة ضمن المدينة
- **الفئات الفرعية (SubCategories)**: لتصنيف أدق للشركات ضمن الفئة الرئيسية

## 📊 هيكل البيانات

### الحقول المطلوبة في ملف CSV

```csv
Nom,Catégorie,Country,City
"شركة مثال","التكنولوجيا","سوريا","دمشق"
```

### الحقول الاختيارية الجديدة

```csv
Nom,Catégorie,SubCategory,Country,City,SubArea
"شركة مثال","التكنولوجيا","تطوير البرمجيات","سوريا","دمشق","المزة"
```

## 🗂️ الفئات الفرعية (SubCategories)

### ما هي الفئة الفرعية؟
الفئة الفرعية هي تصنيف أكثر تحديداً ضمن الفئة الرئيسية. على سبيل المثال:

**الفئة الرئيسية: التكنولوجيا**
- تطوير البرمجيات
- تصميم المواقع
- الأمن السيبراني
- الذكاء الاصطناعي

**الفئة الرئيسية: الأغذية والمطاعم**
- مطاعم عربية
- مطاعم إيطالية
- مطاعم سريعة
- مقاهي ومشروبات

### كيفية استخدام الفئات الفرعية في CSV

#### الطريقة 1: استخدام عمود SubCategory
```csv
Nom,Catégorie,SubCategory
"شركة ABC للبرمجيات","التكنولوجيا","تطوير البرمجيات"
"مطعم الشام","الأغذية والمطاعم","مطاعم عربية"
```

#### الطريقة 2: استخدام عمود subCategory (حروف صغيرة)
```csv
Nom,Catégorie,subCategory
"شركة XYZ","التكنولوجيا","تصميم المواقع"
```

#### الطريقة 3: استخدام عمود Sub Category (بمسافة)
```csv
Nom,Catégorie,Sub Category
"عيادة النور","الرعاية الصحية","طب الأسنان"
```

### آلية المطابقة للفئات الفرعية

1. **مطابقة دقيقة**: البحث عن تطابق تام مع اسم الفئة الفرعية
2. **مطابقة مع تجاهل الأحرف**: `تطوير البرمجيات` = `تطوير البرمجيات`
3. **مطابقة جزئية**: `برمجيات` يطابق `تطوير البرمجيات`
4. **إنشاء جديد**: إذا كانت الإعدادات تسمح، يتم إنشاء فئة فرعية جديدة

### ملاحظات مهمة:
- ✅ الفئة الفرعية **اختيارية** - يمكن تركها فارغة
- ✅ يجب أن تنتمي الفئة الفرعية للفئة الرئيسية المحددة
- ✅ يمكن إنشاء فئات فرعية جديدة تلقائياً
- ⚠️ إذا لم يتم العثور على الفئة الفرعية، سيتم تسجيل تحذير واستكمال الاستيراد

## 📍 المناطق الفرعية (Sub Areas)

### ما هي المنطقة الفرعية؟
المنطقة الفرعية هي حي أو منطقة محددة ضمن المدينة. على سبيل المثال:

**مدينة: دمشق**
- المزة
- أبو رمانة
- المالكي
- الميدان

**مدينة: حلب**
- الشهباء
- العزيزية
- الفرقان
- الحمدانية

### كيفية استخدام المناطق الفرعية في CSV

#### الطريقة 1: استخدام عمود SubArea
```csv
Nom,Country,City,SubArea,Adresse
"شركة ABC","سوريا","دمشق","المزة","شارع المزة أوتوستراد"
"مطعم الشام","سوريا","حلب","الشهباء","حي الشهباء - شارع الملك فيصل"
```

#### الطريقة 2: استخدام عمود subArea (حروف صغيرة)
```csv
Nom,Country,City,subArea
"شركة XYZ","سوريا","دمشق","أبو رمانة"
```

#### الطريقة 3: استخدام عمود Sub Area (بمسافة)
```csv
Nom,Country,City,Sub Area
"عيادة النور","سوريا","دمشق","المالكي"
```

### آلية المطابقة للمناطق الفرعية

1. **مطابقة دقيقة**: البحث عن تطابق تام مع اسم المنطقة في نفس المدينة
2. **مطابقة مع تجاهل الأحرف**: `المزة` = `المزة`
3. **مطابقة جزئية**: `مزة` يطابق `المزة`
4. **إنشاء جديد**: إذا كانت الإعدادات تسمح، يتم إنشاء منطقة فرعية جديدة

### ملاحظات مهمة:
- ✅ المنطقة الفرعية **اختيارية** - يمكن تركها فارغة
- ✅ يجب أن تنتمي المنطقة الفرعية للمدينة المحددة
- ✅ يمكن إنشاء مناطق فرعية جديدة تلقائياً
- ⚠️ إذا لم يتم العثور على المنطقة الفرعية، سيتم تسجيل تحذير واستكمال الاستيراد

## 📝 أمثلة كاملة

### مثال 1: شركة تقنية مع جميع التفاصيل
```csv
Keyword,Nom,Note,Catégorie,SubCategory,Country,City,SubArea,Adresse,Téléphone,SiteWeb
"برمجة دمشق","شركة التقنية المتقدمة","4.5 (12)","التكنولوجيا","تطوير البرمجيات","سوريا","دمشق","المزة","شارع المزة أوتوستراد - بناء ABC","+963 11 1234567","https://example.com"
```

**النتيجة:**
- ✅ الفئة: التكنولوجيا
- ✅ الفئة الفرعية: تطوير البرمجيات
- ✅ البلد: سوريا
- ✅ المدينة: دمشق
- ✅ المنطقة الفرعية: المزة

### مثال 2: مطعم بدون فئة فرعية
```csv
Keyword,Nom,Note,Catégorie,SubCategory,Country,City,SubArea,Adresse,Téléphone
"مطعم حلب","مطعم الشام الأصيل","4.8 (25)","الأغذية والمطاعم","","سوريا","حلب","الشهباء","حي الشهباء - شارع الملك فيصل","+963 21 2345678"
```

**النتيجة:**
- ✅ الفئة: الأغذية والمطاعم
- ⚪ الفئة الفرعية: غير محددة
- ✅ البلد: سوريا
- ✅ المدينة: حلب
- ✅ المنطقة الفرعية: الشهباء

### مثال 3: عيادة بدون منطقة فرعية
```csv
Keyword,Nom,Catégorie,SubCategory,Country,City,SubArea,Téléphone
"عيادة طبية","عيادة النور","الرعاية الصحية","طب الأسنان","سوريا","دمشق","","+963 11 3456789"
```

**النتيجة:**
- ✅ الفئة: الرعاية الصحية
- ✅ الفئة الفرعية: طب الأسنان
- ✅ البلد: سوريا
- ✅ المدينة: دمشق
- ⚪ المنطقة الفرعية: غير محددة

### مثال 4: شركة بدون كلا الحقلين الاختياريين
```csv
Keyword,Nom,Catégorie,Country,City,Téléphone
"محل تجاري","محل البركة","التجارة","سوريا","حمص","+963 31 4567890"
```

**النتيجة:**
- ✅ الفئة: التجارة
- ⚪ الفئة الفرعية: غير محددة
- ✅ البلد: سوريا
- ✅ المدينة: حمص
- ⚪ المنطقة الفرعية: غير محددة

## ⚙️ الإعدادات

### إعدادات الإنشاء التلقائي

عند استيراد CSV، يمكنك التحكم في إنشاء العناصر الجديدة:

```typescript
{
  createMissingCategories: true,  // إنشاء فئات وفئات فرعية جديدة
  createMissingCities: true,      // إنشاء مدن ومناطق فرعية جديدة
}
```

### سلوك النظام:

#### إذا كان `createMissingCategories = true`:
- سيتم إنشاء فئات فرعية جديدة تلقائياً
- سيتم ربطها بالفئة الرئيسية

#### إذا كان `createMissingCategories = false`:
- سيتم البحث فقط عن الفئات الفرعية الموجودة
- إذا لم توجد، سيتم تسجيل تحذير واستكمال الاستيراد بدونها

#### إذا كان `createMissingCities = true`:
- سيتم إنشاء مناطق فرعية جديدة تلقائياً
- سيتم ربطها بالمدينة والبلد

#### إذا كان `createMissingCities = false`:
- سيتم البحث فقط عن المناطق الفرعية الموجودة
- إذا لم توجد، سيتم تسجيل تحذير واستكمال الاستيراد بدونها

## 🔍 استكشاف الأخطاء

### المشكلة: الفئة الفرعية لا تُنشأ

**الأسباب المحتملة:**
1. ❌ `createMissingCategories` معطل
2. ❌ الفئة الرئيسية غير صحيحة أو غير موجودة
3. ❌ خطأ في تهجئة اسم الفئة الفرعية

**الحل:**
1. ✅ تفعيل `createMissingCategories`
2. ✅ التأكد من وجود الفئة الرئيسية
3. ✅ مراجعة اسم الفئة الفرعية

### المشكلة: المنطقة الفرعية لا تُنشأ

**الأسباب المحتملة:**
1. ❌ `createMissingCities` معطل
2. ❌ المدينة أو البلد غير صحيح
3. ❌ خطأ في تهجئة اسم المنطقة الفرعية

**الحل:**
1. ✅ تفعيل `createMissingCities`
2. ✅ التأكد من صحة المدينة والبلد
3. ✅ مراجعة اسم المنطقة الفرعية

### المشكلة: رسالة تحذير "لم يتم العثور على..."

**التفسير:**
- هذا ليس خطأ! العملية ستستمر بنجاح
- سيتم إنشاء الشركة بدون الفئة الفرعية أو المنطقة الفرعية
- يمكنك إضافتها يدوياً لاحقاً من لوحة التحكم

## 📊 سجل التغييرات

### الإصدار 2.0 (أكتوبر 2025)
- ✅ إضافة دعم الفئات الفرعية (SubCategories)
- ✅ إضافة دعم المناطق الفرعية (Sub Areas)
- ✅ تحسين آلية المطابقة (دقيقة، تجاهل الأحرف، جزئية)
- ✅ إضافة خيارات مرنة لأسماء الأعمدة
- ✅ تحسين رسائل السجل والتحذيرات

### الإصدار 1.0 (سبتمبر 2025)
- ✅ النظام الأساسي لاستيراد الشركات
- ✅ دعم الفئات والمدن
- ✅ تحميل الصور
- ✅ معالجة المراجعات

## 🎓 نصائح أفضل الممارسات

### 1. تنظيم البيانات
- 📋 استخدم أسماء موحدة للفئات الفرعية
- 📋 استخدم أسماء موحدة للمناطق الفرعية
- 📋 تجنب الاختصارات غير الواضحة

### 2. الجودة
- ✅ راجع البيانات قبل الاستيراد
- ✅ استخدم قوالب CSV الموحدة
- ✅ اختبر على عينة صغيرة أولاً

### 3. الأداء
- ⚡ قسّم الملفات الكبيرة إلى دفعات أصغر
- ⚡ فعّل الإنشاء التلقائي للسرعة
- ⚡ راقب سجل العمليات

### 4. الصيانة
- 🔧 راجع الفئات الفرعية المُنشأة دورياً
- 🔧 دمج المناطق الفرعية المكررة
- 🔧 تحديث التصنيفات حسب الحاجة

## 📞 الدعم

في حال واجهت أي مشاكل:
1. راجع سجلات وحدة التحكم
2. تحقق من رسائل التحذير والأخطاء
3. راجع هذا الدليل للحلول

---

*تم تحديث هذا الدليل في أكتوبر 2025* 📅

